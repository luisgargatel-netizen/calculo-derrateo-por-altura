
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cálculo de Derrateo por Altura</title>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<style>
    body { font-family: Arial, sans-serif; margin: 20px; display: flex; gap: 30px; }
    .left, .right { width: 50%; }
    input { margin: 5px; padding: 8px; width: 150px; }
    button { padding: 10px 15px; background: #2c3e50; color: #fff; border: none; cursor: pointer; }
    button:hover { background: #34495e; }
    .result { margin-top: 20px; padding: 10px; background: #f4f4f4; border-radius: 5px; }
    table { border-collapse: collapse; width: 100%; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
    th { background-color: #f2f2f2; }
</style>
</head>
<body>
<div class="left">
    <h1>Cálculo de Derrateo por Altura</h1>
    <p>Ingrese los datos:</p>
    <label>Tensión del sistema (kV):</label>
    <input type="number" id="tension" placeholder="Ej: 16"><br>
    <label>Altitud (m):</label>
    <input type="number" id="altitud" placeholder="Ej: 2500"><br>
    <button onclick="calcular()">Calcular</button>
    <div class="result" id="resultado"></div>
</div>

<div class="right">
    <h2>Pasos del cálculo</h2>
    <ol>
        <li>Calcular \( Ki \): Si \( h \leq 1000 \), \( Ki = 1.0 \). Si \( h > 1000 \), \( Ki = e^{(h - 1000)/8150} \).</li>
        <li>Calcular \( Vd = T x Ki \).</li>
        <li>Buscar nivel IEC más próximo hacia arriba.</li>
        <li>Calcular \( VBILd = Ki x VBIL \) y \( Vfd = Ki x Vf \).</li>
        <li>Seleccionar nivel IEC que cumpla \( VBIL > VBILd \) y \( Vf > Vfd \).</li>
    </ol>
    <h3>Tabla IEC 62271-1</h3>
    <table>
        <tr><th>Nivel (kV)</th><th>VBIL (kV)</th><th>Vf (kV)</th></tr>
        <tr><td>3.6</td><td>40</td><td>10</td></tr>
        <tr><td>7.2</td><td>60</td><td>20</td></tr>
        <tr><td>12</td><td>75</td><td>28</td></tr>
        <tr><td>17.5</td><td>95</td><td>38</td></tr>
        <tr><td>24</td><td>125</td><td>50</td></tr>
        <tr><td>36</td><td>170</td><td>70</td></tr>
        <tr><td>52</td><td>250</td><td>95</td></tr>
    </table>
</div>

<script>
function calcular() {
    const T = parseFloat(document.getElementById('tension').value);
    const h = parseFloat(document.getElementById('altitud').value);

    if (isNaN(T) || isNaN(h)) {
        document.getElementById('resultado').innerHTML = "<p style='color:red;'>Por favor ingrese valores válidos.</p>";
        return;
    }

    const Ki = h <= 1000 ? 1.0 : Math.exp((h - 1000) / 8150);
    const Vd = T * Ki;

    const niveles = [
        [3.6, 40, 10],
        [7.2, 60, 20],
        [12, 75, 28],
        [17.5, 95, 38],
        [24, 125, 50],
        [36, 170, 70],
        [52, 250, 95]
    ];

    let nivelBase = niveles[niveles.length - 1];
    for (let n of niveles) {
        if (n[0] >= T) { nivelBase = n; break; }
    }

    const VBILd = Ki * nivelBase[1];
    const Vfd = Ki * nivelBase[2];

    let nivelSeleccionado = "No encontrado";
    for (let n of niveles) {
        if (n[1] > VBILd && n[2] > Vfd) {
            nivelSeleccionado = n[0];
            break;
        }
    }

    document.getElementById('resultado').innerHTML = `
        <h3>Resultados:</h3>
        <p>Ki = ${Ki.toFixed(5)}</p>
        <p>Vd = ${Vd.toFixed(5)} kV</p>
        <p>VBILd = ${VBILd.toFixed(5)} kV</p>
        <p>Vfd = ${Vfd.toFixed(5)} kV</p>
        <p>Nivel base: ${nivelBase[0]} kV</p>
        <p>Nivel seleccionado: ${nivelSeleccionado} kV</p>
    `;
}
</script>
</body>
</html>
